<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Kalkulator Trading</title>

<style>
body{
    background:#0f0f0f;
    color:white;
    font-family:Arial;
    padding:20px;
}
.container{
    max-width:600px;
    margin:auto;
}
input{
    width:100%;
    padding:10px;
    margin-bottom:10px;
    background:#1a1a1a;
    border:1px solid #333;
    color:white;
}
button{
    width:100%;
    padding:12px;
    background:#00aa88;
    border:none;
    color:white;
    font-weight:bold;
    cursor:pointer;
}
.result{
    margin-top:20px;
    padding:15px;
    background:#1a1a1a;
}
.green{color:#00ff88;}
.red{color:#ff4444;}
.suggestions{
    background:#1a1a1a;
    border:1px solid #333;
    max-height:150px;
    overflow-y:auto;
    margin-top:-8px;
    margin-bottom:10px;
}
.suggestions div{
    padding:8px;
    cursor:pointer;
}
.suggestions div:hover{
    background:#333;
}
</style>
</head>

<body>

<div class="container">

<h2>Kalkulator Zysku / Straty</h2>

<label>Szukaj instrumentu</label>
<input type="text" id="search" placeholder="Np. AAPL, US100, EURUSD">
<div class="suggestions" id="suggestions"></div>

<label>Typ</label>
<select id="type">
<option value="buy">BUY</option>
<option value="sell">SELL</option>
</select>

<label>Kwota pozycji (PLN)</label>
<input type="number" id="amount" value="1000">

<label>Cena wejÅ›cia</label>
<input type="number" id="entry" step="0.00001">

<label>Stop Loss</label>
<input type="number" id="sl" step="0.00001">

<label>Take Profit</label>
<input type="number" id="tp" step="0.00001">

<label>DÅºwignia</label>
<input type="number" id="leverage" value="30">

<button onclick="calculate()">OBLICZ</button>

<div class="result" id="results"></div>

</div>

<script>

let instruments = [];
let selectedInstrument = null;

// ðŸ”¹ Åadowanie JSON
fetch("xtb.json")
.then(res => res.json())
.then(data => {
    instruments = data.instruments;
})
.catch(err => {
    console.error("BÅ‚Ä…d Å‚adowania xtb.json:", err);
});

// ðŸ”¹ Wyszukiwarka
document.getElementById("search").addEventListener("input", function(){

    let value = this.value.toLowerCase();
    let suggestionsBox = document.getElementById("suggestions");
    suggestionsBox.innerHTML = "";

    if(value.length < 1) return;

    let filtered = instruments.filter(inst =>
        inst.symbol.toLowerCase().includes(value)
    ).slice(0,20);

    filtered.forEach(inst => {
        let div = document.createElement("div");
        div.textContent = inst.symbol;
        div.onclick = function(){
            document.getElementById("search").value = inst.symbol;
            selectedInstrument = inst;
            suggestionsBox.innerHTML = "";
        };
        suggestionsBox.appendChild(div);
    });

});

// ðŸ”¹ Kalkulator
function calculate(){

if(!selectedInstrument){
    alert("Wybierz instrument z listy.");
    return;
}

let amount = parseFloat(document.getElementById("amount").value);
let entry = parseFloat(document.getElementById("entry").value);
let sl = parseFloat(document.getElementById("sl").value);
let tp = parseFloat(document.getElementById("tp").value);
let leverage = parseFloat(document.getElementById("leverage").value);
let type = document.getElementById("type").value;

if(!entry || !sl || !tp){
    alert("UzupeÅ‚nij ceny.");
    return;
}

// iloÅ›Ä‡ jednostek
let quantity = amount / entry;

// margin
let margin = amount / leverage;

// dystans
let slDistance = type==="buy" ? (entry - sl) : (sl - entry);
let tpDistance = type==="buy" ? (tp - entry) : (entry - tp);

// zysk / strata
let riskMoney = slDistance * quantity;
let rewardMoney = tpDistance * quantity;

let rr = rewardMoney / riskMoney;

document.getElementById("results").innerHTML = `
<b>Instrument:</b> ${selectedInstrument.symbol}<br>
<b>Kwota pozycji:</b> ${amount.toFixed(2)} PLN<br>
<b>IloÅ›Ä‡ jednostek:</b> ${quantity.toFixed(4)}<br>
<b>Margin:</b> ${margin.toFixed(2)} PLN<br>
<hr>
<b>Ryzyko:</b> <span class="red">${riskMoney.toFixed(2)} PLN</span><br>
<b>Zysk:</b> <span class="green">${rewardMoney.toFixed(2)} PLN</span><br>
<b>R:R:</b> ${rr.toFixed(2)}
`;

}

</script>

</body>
</html>
